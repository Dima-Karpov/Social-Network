{"ast":null,"code":"import _regeneratorRuntime from\"D:/My-proect/social-network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/My-proect/social-network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"D:/My-proect/social-network/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{authAPI}from'../api/api';var SET_USER_DATA='SET-USER-DATA';var initialState={id:null,email:null,login:null,isAuth:false};var authReducer=function authReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_USER_DATA:return _objectSpread(_objectSpread({},state),action.payload);default:return state;};};export var setAuthUserData=function setAuthUserData(id,email,login,isAuth){return{type:SET_USER_DATA,payload:{id:id,email:email,login:login,isAuth:isAuth}};};export var getAuthUserData=function getAuthUserData(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:authAPI.me().then(function(response){if(response.data.resultCode===0){var _response$data$data=response.data.data,id=_response$data$data.id,email=_response$data$data.email,_login=_response$data$data.login;dispatch(setAuthUserData(id,email,_login,true));}});case 1:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var login=function login(email,password,rememberMe){return function(dispatch){authAPI.login(email,password,rememberMe).then(function(response){if(response.data.resultCode===0){dispatch(getAuthUserData());}});};};export var logout=function logout(){return function(dispatch){authAPI.logout().then(function(response){if(response.data.resultCode===0){dispatch(setAuthUserData(null,null,null,false));}});};};export default authReducer;","map":{"version":3,"sources":["D:/My-proect/social-network/src/redux/auth-reducer.tsx"],"names":["authAPI","SET_USER_DATA","initialState","id","email","login","isAuth","authReducer","state","action","type","payload","setAuthUserData","getAuthUserData","dispatch","me","then","response","data","resultCode","password","rememberMe","logout"],"mappings":"kbAGA,OAASA,OAAT,KAAwB,YAAxB,CAMA,GAAMC,CAAAA,aAAa,CAAG,eAAtB,CASA,GAAMC,CAAAA,YAAY,CAAG,CACjBC,EAAE,CAAE,IADa,CAEjBC,KAAK,CAAE,IAFU,CAGjBC,KAAK,CAAE,IAHU,CAIjBC,MAAM,CAAE,KAJS,CAArB,CAOA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAA4E,IAA3EC,CAAAA,KAA2E,2DAApDN,YAAoD,IAAtCO,CAAAA,MAAsC,2CAE5F,OAAQA,MAAM,CAACC,IAAf,EACI,IAAKT,CAAAA,aAAL,CACI,sCACOO,KADP,EAEOC,MAAM,CAACE,OAFd,EAIJ,QACI,MAAOH,CAAAA,KAAP,CAPR,CAQC,CACJ,CAXD,CAcA,MAAO,IAAMI,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAET,EAAF,CAAqBC,KAArB,CAA2CC,KAA3C,CAAiEC,MAAjE,CAAqF,CAChH,MAAO,CACHI,IAAI,CAAET,aADH,CAEHU,OAAO,CAAE,CAACR,EAAE,CAAFA,EAAD,CAAKC,KAAK,CAALA,KAAL,CAAYC,KAAK,CAALA,KAAZ,CAAmBC,MAAM,CAANA,MAAnB,CAFN,CAAP,CAIH,CALM,CAOP,MAAO,IAAMO,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAqE,CAChG,+FAAO,iBAAOC,QAAP,kHACHd,OAAO,CAACe,EAAR,GACKC,IADL,CACU,SAAAC,QAAQ,CAAI,CACd,GAAIA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAAjC,CAAoC,yBACLF,QAAQ,CAACC,IAAT,CAAcA,IADT,CAC1Bf,EAD0B,qBAC1BA,EAD0B,CACtBC,KADsB,qBACtBA,KADsB,CACfC,MADe,qBACfA,KADe,CAEhCS,QAAQ,CAACF,eAAe,CAACT,EAAD,CAAKC,KAAL,CAAYC,MAAZ,CAAmB,IAAnB,CAAhB,CAAR,CACH,CACJ,CANL,EADG,sDAAP,+DASH,CAVM,CAYP,MAAO,IAAMA,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,CAACD,KAAD,CAAgBgB,QAAhB,CAAkCC,UAAlC,QAA0D,UAACP,QAAD,CAA6B,CACxGd,OAAO,CAACK,KAAR,CAAcD,KAAd,CAAqBgB,QAArB,CAA+BC,UAA/B,EACKL,IADL,CACU,SAAAC,QAAQ,CAAI,CACd,GAAIA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAAjC,CAAoC,CAChCL,QAAQ,CAACD,eAAe,EAAhB,CAAR,CACH,CACJ,CALL,EAMH,CAPoB,EAAd,CAQP,MAAO,IAAMS,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,SAAM,UAACR,QAAD,CAA6B,CACrDd,OAAO,CAACsB,MAAR,GACKN,IADL,CACU,SAAAC,QAAQ,CAAI,CACd,GAAIA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAAjC,CAAoC,CAChCL,QAAQ,CAACF,eAAe,CAAC,IAAD,CAAO,IAAP,CAAa,IAAb,CAAmB,KAAnB,CAAhB,CAAR,CACH,CACJ,CALL,EAMH,CAPqB,EAAf,CAYP,cAAeL,CAAAA,WAAf","sourcesContent":["import React from 'react';\r\nimport { Dispatch } from 'redux';\r\nimport { ThunkAction } from 'redux-thunk';\r\nimport { authAPI } from '../api/api';\r\nimport { AppStateType } from './redux-store';\r\n\r\n\r\ntype ActionType = ReturnType<typeof setAuthUserData>\r\n\r\nconst SET_USER_DATA = 'SET-USER-DATA';\r\n\r\nexport type InitStateType = {\r\n    id: number | null,\r\n    email: string | null,\r\n    login:  string | null,\r\n    isAuth: boolean,\r\n};\r\n\r\nconst initialState = {\r\n    id: null,\r\n    email: null,\r\n    login: null,\r\n    isAuth: false,\r\n};\r\n\r\nconst authReducer = (state: InitStateType = initialState, action: ActionType): InitStateType => {\r\n\r\n    switch (action.type) {\r\n        case SET_USER_DATA :\r\n            return {\r\n                ...state,\r\n                ...action.payload,\r\n            }\r\n        default: \r\n            return state;\r\n    };\r\n};\r\n\r\n\r\nexport const setAuthUserData = ( id: number | null, email: string | null, login: string | null, isAuth: boolean) => {\r\n    return {\r\n        type: SET_USER_DATA,\r\n        payload: {id, email, login, isAuth}\r\n    } as const\r\n};\r\n\r\nexport const getAuthUserData = (): ThunkAction<Promise<void>, AppStateType, unknown, ActionType> => {\r\n    return async (dispatch) => {\r\n        authAPI.me()\r\n            .then(response => {\r\n                if (response.data.resultCode === 0) {\r\n                    let { id, email, login } = response.data.data;\r\n                    dispatch(setAuthUserData(id, email, login, true))\r\n                }\r\n            })\r\n    }\r\n};\r\n\r\nexport const login = (email: string, password: string, rememberMe: boolean) => (dispatch: Dispatch<any>) => {\r\n    authAPI.login(email, password, rememberMe)\r\n        .then(response => {\r\n            if (response.data.resultCode === 0) {\r\n                dispatch(getAuthUserData())\r\n            }\r\n        })\r\n};\r\nexport const logout = () => (dispatch: Dispatch<any>) => {\r\n    authAPI.logout()\r\n        .then(response => {\r\n            if (response.data.resultCode === 0) {\r\n                dispatch(setAuthUserData(null, null, null, false))\r\n            }\r\n        })\r\n};\r\n\r\n\r\n\r\n\r\nexport default authReducer"]},"metadata":{},"sourceType":"module"}